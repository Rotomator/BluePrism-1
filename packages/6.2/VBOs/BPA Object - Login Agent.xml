<process name="Login Agent" version="1.0" narrative="VBO which enables access to the login / password management functionality of Windows Vista / 7" type="object" runmode="Exclusive" preferredid="7dce60b6-0b96-4fe1-9490-be356b6325bc">
  <appdef>
    <element name="Application Root">
      <id>46713547-5924-43ae-becb-743e33ff287e</id>
      <type>Application</type>
      <basetype>Application</basetype>
      <datatype>unknown</datatype>
      <diagnose>False</diagnose>
    </element>
  </appdef>
  <view>
    <camerax>0</camerax>
    <cameray>0</cameray>
    <zoom>1</zoom>
  </view>
  <preconditions />
  <endpoint narrative="" />
  <subsheet subsheetid="fced009d-9e12-4a77-bb34-39c1b5b5f09a" type="CleanUp" published="True">
    <name>Clean Up</name>
    <view>
      <camerax>0</camerax>
      <cameray>0</cameray>
      <zoom>1</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="8844e841-e52e-4c9e-8e09-83f96fe6b114" type="Normal" published="True">
    <name>Get Credential Name</name>
    <view>
      <camerax>0</camerax>
      <cameray>0</cameray>
      <zoom>1</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="3b5b1d1e-cc3f-42d1-b366-db7b87ef1b31" type="Normal" published="False">
    <name>Authenticate To Windows</name>
    <view>
      <camerax>52</camerax>
      <cameray>0</cameray>
      <zoom>1</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="58da59f5-3981-487b-bce1-4955720512fd" type="Normal" published="True">
    <name>Logged In Users</name>
    <view>
      <camerax>0</camerax>
      <cameray>0</cameray>
      <zoom>1</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="496ea765-a2a8-40ba-abdc-f03c5adc3c11" type="Normal" published="True">
    <name>Change Password</name>
    <view>
      <camerax>0</camerax>
      <cameray>0</cameray>
      <zoom>1</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="fc7330a9-6031-4a16-9d1a-37eaad47dd3c" type="Normal" published="True">
    <name>Log In</name>
    <view>
      <camerax>0</camerax>
      <cameray>-64</cameray>
      <zoom>1</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="16600e55-0e0d-48bb-af54-c9481546764d" type="Normal" published="True">
    <name>Log Out</name>
    <view>
      <camerax>0</camerax>
      <cameray>0</cameray>
      <zoom>1</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="9be1bfb7-5b8e-4745-835d-94edb996a86d" type="Normal" published="True">
    <name>Is Logged In</name>
    <view>
      <camerax>0</camerax>
      <cameray>0</cameray>
      <zoom>1</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="591a313e-ab53-49d4-8aa0-867fc82c9d18" type="Normal" published="True">
    <name>Lock Screen</name>
    <view>
      <camerax>0</camerax>
      <cameray>0</cameray>
      <zoom>1</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="92b155c1-247d-473f-9f8b-f093f6dffbcf" type="Normal" published="True">
    <name>Unlock Screen</name>
    <view>
      <camerax>0</camerax>
      <cameray>7</cameray>
      <zoom>1</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="8b88ea92-5fc1-4135-8889-56a9438354ad" type="Normal" published="True">
    <name>Is Locked</name>
    <view>
      <camerax>18</camerax>
      <cameray>7</cameray>
      <zoom>1</zoom>
    </view>
  </subsheet>
  <stage stageid="0b82de45-8e17-403c-b535-9e27aff5d856" name="Start" type="Start">
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <onsuccess>d92454db-9a9c-4c01-b3d1-565149f45600</onsuccess>
  </stage>
  <stage stageid="d92454db-9a9c-4c01-b3d1-565149f45600" name="End" type="End">
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="347da190-6f5b-4b64-84be-4d0db90b5013" name="Stage1" type="ProcessInfo">
    <narrative>
    </narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <references>
      <reference>System.Data.dll</reference>
      <reference>System.Xml.dll</reference>
      <reference>System.Drawing.dll</reference>
      <reference>System.DirectoryServices.dll</reference>
      <reference>System.Management.dll</reference>
    </references>
    <imports>
      <import>System</import>
      <import>System.Drawing</import>
      <import>System.DirectoryServices</import>
      <import>System.Runtime.InteropServices</import>
      <import>Microsoft.VisualBasic</import>
      <import>System.Collections.Generic</import>
      <import>System.Management</import>
      <import>System.Data</import>
      <import>Microsoft.Win32.SafeHandles</import>
      <import>System.IO</import>
      <import>System.Text</import>
      <import>System.Reflection</import>
    </imports>
    <language>visualbasic</language>
    <globalcode><![CDATA[]]></globalcode>
    <code><![CDATA[Implements IDisposable

<DllImport("user32.dll")> _
Public Shared Function LockWorkStation() As Boolean
End Function

<DllImport("user32.dll")> _
Public Shared Sub ExitWindowsEx(ByVal uFlags As Integer, ByVal dwReason As Integer)
End Sub

<DllImport("user32.dll")> _
Private Shared Function OpenInputDesktop( _
  ByVal dwFlags As UInteger, _
  ByVal fInherit As Boolean, _
  ByVal dwDesiredAccess As UInteger) As IntPtr
End Function

<DllImport("user32.dll")> _
Private Shared Function CloseDesktop(ByVal hDesktop As IntPtr) As Boolean
End Function

<DllImport("kernel32.dll", SetLastError:=True)> _
 Public Shared Function CreateFile( _
  ByVal pipeName As String, _
  ByVal dwDesiredAccess As UInt32, _
  ByVal dwShareMode As UInt32, _
  ByVal lpSecurityAttributes As IntPtr, _
  ByVal dwCreationDisposition As UInt32, _
  ByVal dwFlagsAndAttributes As UInt32, _
  ByVal hTemplate As IntPtr) As SafeFileHandle
End Function

Public Enum NET_API_STATUS As UInteger
   NERR_Success = 0
   NERR_InvalidComputer = 2351
   NERR_NotPrimary = 2226
   NERR_SpeGroupOp = 2234
   NERR_LastAdmin = 2452
   NERR_BadPassword = 2203
   NERR_PasswordTooShort = 2245
   NERR_UserNotFound = 2221
   ERROR_ACCESS_DENIED = 5
   ERROR_NOT_ENOUGH_MEMORY = 8
   ERROR_INVALID_PARAMETER = 87
   ERROR_INVALID_NAME = 123
   ERROR_INVALID_LEVEL = 124 
   ERROR_SESSION_CREDENTIAL_CONFLICT = 1219
   RPC_S_SERVER_UNAVAILABLE = 2147944122
   RPC_E_REMOTE_DISABLED = 2147549468
End Enum

<DllImport("netapi32.dll")> _
Public Shared Function NetUserChangePassword( _
    <MarshalAs(UnmanagedType.LPWStr)> ByVal Domain As String, _
    <MarshalAs(UnmanagedType.LPWStr)> ByVal User As String, _
    <MarshalAs(UnmanagedType.LPWStr)> ByVal OldPass As String, _
    <MarshalAs(UnmanagedType.LPWStr)> ByVal NewPass As String) As NET_API_STATUS
End Function

Public Const GENERIC_READ As UInt32 = &H80000000UI ' "UI" suffix = unsigned int
Public Const GENERIC_WRITE As UInt32 = &H40000000
Public Const OPEN_EXISTING As UInt32 = 3
Public Const FILE_FLAG_OVERLAPPED As UInt32 = &H40000000

Private Const PipeName As String = "BluePrismCredentialProviderPipe"

Public Enum ExitWindowsFlags
	LogOff = &H0
	ShutDown = &H1
	Reboot = &H2
	PowerOff = &H8
	RestartApps = &H40

	Force = &H4
	ForceIfHung = &H10
End Enum

Public Sub New()
	AddHandler Microsoft.Win32.SystemEvents.SessionSwitch, AddressOf SessionSwitch
End Sub

Private m_Locked As Boolean

Public Sub SessionSwitch(ByVal Sender As Object, ByVal e As Microsoft.Win32.SessionSwitchEventArgs)
	Select Case e.Reason
		Case Microsoft.Win32.SessionSwitchReason.SessionLock
			m_Locked = True
		Case Microsoft.Win32.SessionSwitchReason.SessionUnlock
			m_Locked = False
	End Select
End Sub

Public Sub ExitWindowsDelay(ByVal o As Object)
	Dim args As List(Of Object) = DirectCast(o, List(Of Object))
	Dim Flags As Integer = DirectCast(args(0), Integer)
	Dim Delay As TimeSpan = DirectCast(args(1), TimeSpan)
	System.Threading.Thread.Sleep(Delay)
	ExitWindowsEx(Flags, 0)
End Sub

Public Function GetLoggedInUsers() As ICollection(Of String)
	Dim users As New List(Of String)

	Dim options As New ConnectionOptions()
	Dim scope As New ManagementScope("\\localhost", options)

	Dim query As New ObjectQuery("select * from Win32_ComputerSystem")
	Dim searcher As New ManagementObjectSearcher(scope, query)
	Dim results As ManagementObjectCollection = searcher.[Get]()

	For Each result As ManagementObject In results
		Dim username As String = TryCast(result("UserName"), String)
		If username IsNot Nothing Then
			users.Add(username)
		End If
	Next

	Return users
End Function

Public Overloads Sub Dispose() Implements IDisposable.Dispose
	Dispose(True)
	GC.SuppressFinalize(Me)
End Sub

Protected Overloads Sub Dispose(ByVal disposing As Boolean)
	If disposing Then
		RemoveHandler Microsoft.Win32.SystemEvents.SessionSwitch, AddressOf SessionSwitch
	End If
End Sub

Protected Overrides Sub Finalize()
	Dispose(False)
End Sub]]></code>
  </stage>
  <stage stageid="b7dfc087-cf26-4d2c-bd34-a466b2fadeb5" name="Clean Up" type="SubSheetInfo">
    <subsheetid>fced009d-9e12-4a77-bb34-39c1b5b5f09a</subsheetid>
    <narrative>
    </narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="6e3b12a4-b1eb-4ccb-9fd0-e42c3aa02287" name="Start" type="Start">
    <subsheetid>fced009d-9e12-4a77-bb34-39c1b5b5f09a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <onsuccess>b29afe99-70c6-4e8a-afb5-a8f3a2e83643</onsuccess>
  </stage>
  <stage stageid="b29afe99-70c6-4e8a-afb5-a8f3a2e83643" name="End" type="End">
    <subsheetid>fced009d-9e12-4a77-bb34-39c1b5b5f09a</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="1d3d4e0d-9e4c-466d-aed2-f31dc9fb5e49" name="Change Password" type="SubSheetInfo">
    <subsheetid>496ea765-a2a8-40ba-abdc-f03c5adc3c11</subsheetid>
    <narrative>
    </narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="36705d55-0e5b-4a3b-bb7a-0e0c502b837b" name="Start" type="Start">
    <subsheetid>496ea765-a2a8-40ba-abdc-f03c5adc3c11</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="password" name="Old Password" stage="Old Password" />
      <input type="password" name="New Password" stage="New Password" />
    </inputs>
    <onsuccess>d7909204-65b8-456f-938a-f56a9e178208</onsuccess>
  </stage>
  <stage stageid="3abddde9-203a-44ea-998e-46c94f498b48" name="End" type="End">
    <subsheetid>496ea765-a2a8-40ba-abdc-f03c5adc3c11</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="a9716bd2-f48c-4229-92e5-1930717935d8" name="new" type="Note">
    <subsheetid>fced009d-9e12-4a77-bb34-39c1b5b5f09a</subsheetid>
    <narrative>Clean Up Page

This is an optional page where you might choose to perform some finalisation (or "cleanup") tasks as your business object is closed down.

The cleanup action will be called automatically immediately after closing your business object at the end of a business process.

You will not be able to call this action from a business process, nor will it be called at any other time than before the disposal of the business object.</narrative>
    <displayx>-180</displayx>
    <displayy>60</displayy>
    <displaywidth>180</displaywidth>
    <displayheight>230</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="c0f82a1a-7831-469d-9d19-a424e7e6b349" name="new" type="Note">
    <narrative>Initialise Page

This is an optional page where you might choose to perform some initialisation tasks after your business object is loaded.

The initialise action will be called automatically immediately after loading your business object.

You will not be able to call this action from a business process, nor will it be called at any other time than after the creation of the object.</narrative>
    <displayx>-180</displayx>
    <displayy>60</displayy>
    <displaywidth>180</displaywidth>
    <displayheight>230</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="b4bf3f9e-550c-4f46-99d4-141767b98f95" name="Old Password" type="Data">
    <subsheetid>496ea765-a2a8-40ba-abdc-f03c5adc3c11</subsheetid>
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>password</datatype>
    <initialvalueenc>
    </initialvalueenc>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="10f89c79-e344-4100-b461-e45d84c6b07b" name="New Password" type="Data">
    <subsheetid>496ea765-a2a8-40ba-abdc-f03c5adc3c11</subsheetid>
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>password</datatype>
    <initialvalueenc>
    </initialvalueenc>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d7909204-65b8-456f-938a-f56a9e178208" name="Change Password" type="Code">
    <subsheetid>496ea765-a2a8-40ba-abdc-f03c5adc3c11</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="password" name="oldPass" expr="[Old Password]" />
      <input type="password" name="newPass" expr="[New Password]" />
    </inputs>
    <onsuccess>3abddde9-203a-44ea-998e-46c94f498b48</onsuccess>
    <code><![CDATA[Dim res As NET_API_STATUS = NetUserChangePassword(Environment.UserDomainName, Environment.UserName, oldPass, newPass)
If res <> NET_API_STATUS.NERR_Success Then
   Throw New ApplicationException("Error setting password - Error code:" & res.ToString())
End If]]></code>
  </stage>
  <stage stageid="575e4443-3f94-4663-8eb8-10d3f0978316" name="Lock Screen" type="SubSheetInfo">
    <subsheetid>591a313e-ab53-49d4-8aa0-867fc82c9d18</subsheetid>
    <narrative>
    </narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="1cbcdecd-d2b5-4b18-81c7-d6b36a3c0b29" name="Start" type="Start">
    <subsheetid>591a313e-ab53-49d4-8aa0-867fc82c9d18</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-150</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <onsuccess>dd07b920-d654-4c33-b274-460788bd6985</onsuccess>
  </stage>
  <stage stageid="f4b4fb18-6797-4ab8-9e69-d8d5d119e668" name="End" type="End">
    <subsheetid>591a313e-ab53-49d4-8aa0-867fc82c9d18</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="7e0cf464-c1c2-4c1a-b885-d55f2b4d6deb" name="Lock Screen" type="Code">
    <subsheetid>591a313e-ab53-49d4-8aa0-867fc82c9d18</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>30</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <onsuccess>f4b4fb18-6797-4ab8-9e69-d8d5d119e668</onsuccess>
    <code><![CDATA[LockWorkStation()]]></code>
  </stage>
  <stage stageid="fb0f2048-7568-4f40-96ce-44524ee7fb96" name="Log Out" type="SubSheetInfo">
    <subsheetid>16600e55-0e0d-48bb-af54-c9481546764d</subsheetid>
    <narrative>
    </narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="7bf32b65-ec43-4f09-a270-92a4bdd3cda3" name="Start" type="Start">
    <subsheetid>16600e55-0e0d-48bb-af54-c9481546764d</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="flag" name="Force" narrative="Forces a shutdown if applications are running" stage="Force" />
      <input type="timespan" name="Delay" narrative="A Delay before shutdown occours" stage="Delay" />
    </inputs>
    <onsuccess>5c4d00c8-ea22-4a0c-8f86-f1557aca83c4</onsuccess>
  </stage>
  <stage stageid="5c619424-d049-4499-a7af-4a8caa73c838" name="End" type="End">
    <subsheetid>16600e55-0e0d-48bb-af54-c9481546764d</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="5c4d00c8-ea22-4a0c-8f86-f1557aca83c4" name="Log Out" type="Code">
    <subsheetid>16600e55-0e0d-48bb-af54-c9481546764d</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="flag" name="Force" expr="[Force]" />
      <input type="timespan" name="Delay" expr="[Delay]" />
    </inputs>
    <onsuccess>5c619424-d049-4499-a7af-4a8caa73c838</onsuccess>
    <code><![CDATA[Dim flags as ExitWindowsFlags = ExitWindowsFlags.LogOff
If Force Then flags = flags Or ExitWindowsFlags.Force

Dim t As New Threading.Thread(Addressof ExitWindowsDelay)
Dim args As New List(Of Object)
args.Add(flags)
args.Add(Delay)
t.Start(args)]]></code>
  </stage>
  <stage stageid="8795c94f-4605-43b5-a515-a358ce7259bf" name="Force" type="Data">
    <subsheetid>16600e55-0e0d-48bb-af54-c9481546764d</subsheetid>
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="84ef1c60-5f00-4c91-bef3-0ae7369d94ca" name="Unlock Screen" type="SubSheetInfo">
    <subsheetid>92b155c1-247d-473f-9f8b-f093f6dffbcf</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="4dfea8a1-86a0-45e8-8d9c-6eee47f8b53b" name="Start" type="Start">
    <subsheetid>92b155c1-247d-473f-9f8b-f093f6dffbcf</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="password" name="Password" stage="Password" />
      <input type="flag" name="Local" stage="Local" />
    </inputs>
    <onsuccess>6a9ee0ab-36bc-4582-8f61-90946fc87ac2</onsuccess>
  </stage>
  <stage stageid="8a0ffee8-4561-44b5-be27-ab6b6989810d" name="End" type="End">
    <subsheetid>92b155c1-247d-473f-9f8b-f093f6dffbcf</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>165</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="a05c287e-8eea-4f02-be52-d591f9a34e43" name="Log In" type="SubSheetInfo">
    <subsheetid>fc7330a9-6031-4a16-9d1a-37eaad47dd3c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-210</displayx>
    <displayy>-135</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="ce3cef39-0134-470c-b59c-273616b66622" name="End" type="End">
    <subsheetid>fc7330a9-6031-4a16-9d1a-37eaad47dd3c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>30</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="f6144f11-a343-4acb-b935-4c9900f34a2f" name="Is Locked" type="SubSheetInfo">
    <subsheetid>8b88ea92-5fc1-4135-8889-56a9438354ad</subsheetid>
    <narrative>
    </narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="422854bf-de95-47a8-82ad-9a4faba10ec0" name="Start" type="Start">
    <subsheetid>8b88ea92-5fc1-4135-8889-56a9438354ad</subsheetid>
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <onsuccess>9fe2dde9-48a0-40ad-89b5-046add650133</onsuccess>
  </stage>
  <stage stageid="f738eca2-c3bf-42d5-b5b5-aedfaa9295f5" name="End" type="End">
    <subsheetid>8b88ea92-5fc1-4135-8889-56a9438354ad</subsheetid>
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="Locked" stage="Locked" />
    </outputs>
  </stage>
  <stage stageid="a16812d6-ceff-457c-96ee-f5e859924734" name="Locked" type="Data">
    <subsheetid>8b88ea92-5fc1-4135-8889-56a9438354ad</subsheetid>
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="f206c22a-d1c7-4c7f-9a17-3181943398bc" name="Locked?" type="Code">
    <subsheetid>8b88ea92-5fc1-4135-8889-56a9438354ad</subsheetid>
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="Locked" stage="Locked" />
    </outputs>
    <onsuccess>f738eca2-c3bf-42d5-b5b5-aedfaa9295f5</onsuccess>
    <code><![CDATA[If m_Locked Then Locked = True : Return

' If we've not got 'locked' set, it may be that
' we're not locked, or it might mean that the
' VBO wasn't active when the screen was locked
' Try and get the desktop window to see if we're
' currently locked or not

Dim hDesk as IntPtr = OpenInputDesktop(0, False, 1)
Locked = (hDesk = IntPtr.Zero)
CloseDesktop(hDesk)
]]></code>
  </stage>
  <stage stageid="7a388dca-6f91-48dc-bdab-97fef8f04515" name="Password" type="Data">
    <subsheetid>92b155c1-247d-473f-9f8b-f093f6dffbcf</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>password</datatype>
    <initialvalueenc>
    </initialvalueenc>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="5c5a86db-ef99-4e1e-a81e-6bc5be62d1aa" name="Is Locked?" type="Decision">
    <subsheetid>92b155c1-247d-473f-9f8b-f093f6dffbcf</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <decision expression="[Locked]" />
    <ontrue>17da5cbb-398c-46f9-80df-256cf8f1aeb3</ontrue>
    <onfalse>bc8bc43d-b16e-4e90-846a-38edc5d9c052</onfalse>
  </stage>
  <stage stageid="6a9ee0ab-36bc-4582-8f61-90946fc87ac2" name="Is Locked" type="SubSheet">
    <subsheetid>92b155c1-247d-473f-9f8b-f093f6dffbcf</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="Locked" stage="Locked" />
    </outputs>
    <onsuccess>5c5a86db-ef99-4e1e-a81e-6bc5be62d1aa</onsuccess>
    <processid>8b88ea92-5fc1-4135-8889-56a9438354ad</processid>
  </stage>
  <stage stageid="bca60a1a-50dc-43d5-b42e-ca8b9631768f" name="Locked" type="Data">
    <subsheetid>92b155c1-247d-473f-9f8b-f093f6dffbcf</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>-60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="bc8bc43d-b16e-4e90-846a-38edc5d9c052" name="End1" type="End">
    <subsheetid>92b155c1-247d-473f-9f8b-f093f6dffbcf</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-75</displayx>
    <displayy>-15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="f4c2bd72-767a-4d95-8dcc-e6a5d17ee779" name="Username" type="Data">
    <subsheetid>fc7330a9-6031-4a16-9d1a-37eaad47dd3c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>-180</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="140a269f-f46d-402a-a773-2f88ad2d26b9" name="Password" type="Data">
    <subsheetid>fc7330a9-6031-4a16-9d1a-37eaad47dd3c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>-180</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>password</datatype>
    <initialvalueenc>
    </initialvalueenc>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="a2bbd219-9ae0-4281-9907-d85e1a7ca496" name="Unlock" type="SubSheet">
    <subsheetid>92b155c1-247d-473f-9f8b-f093f6dffbcf</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Username" narrative="The username to use to authenticate to windows" expr="[Username]" />
      <input type="password" name="Password" narrative="The password to use to authenticate to Windows" expr="[Password]" />
      <input type="flag" name="Local" narrative="True to authenticate using local machine authentication; False to use domain authentication" expr="[Local]" />
      <input type="text" name="Domain" narrative="The name of the domain to authenticate with. Ignored if 'Local' is true; If blank will use the domain that the machine is a member of" expr="[Domain]" />
    </inputs>
    <onsuccess>8a0ffee8-4561-44b5-be27-ab6b6989810d</onsuccess>
    <processid>3b5b1d1e-cc3f-42d1-b366-db7b87ef1b31</processid>
  </stage>
  <stage stageid="17da5cbb-398c-46f9-80df-256cf8f1aeb3" name="Get Username &amp; Domain" type="Code">
    <subsheetid>92b155c1-247d-473f-9f8b-f093f6dffbcf</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>45</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="text" name="Username" stage="Username" />
      <output type="text" name="Domain" stage="Domain" />
    </outputs>
    <onsuccess>a2bbd219-9ae0-4281-9907-d85e1a7ca496</onsuccess>
    <code><![CDATA[Username = Environment.UserName
Domain = Environment.UserDomainName]]></code>
  </stage>
  <stage stageid="cfe76f8a-10ba-4bb3-b827-5b48b8628960" name="Username" type="Data">
    <subsheetid>92b155c1-247d-473f-9f8b-f093f6dffbcf</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="80cfeada-7b35-4af0-942e-3583ceba3e24" name="Is Locked?" type="Decision">
    <subsheetid>591a313e-ab53-49d4-8aa0-867fc82c9d18</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-30</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <decision expression="[Locked]" />
    <ontrue>4765a529-45f2-4cd1-a8c9-73317e3346f7</ontrue>
    <onfalse>7e0cf464-c1c2-4c1a-b885-d55f2b4d6deb</onfalse>
  </stage>
  <stage stageid="dd07b920-d654-4c33-b274-460788bd6985" name="Is Locked" type="SubSheet">
    <subsheetid>591a313e-ab53-49d4-8aa0-867fc82c9d18</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="Locked" stage="Locked" />
    </outputs>
    <onsuccess>80cfeada-7b35-4af0-942e-3583ceba3e24</onsuccess>
    <processid>8b88ea92-5fc1-4135-8889-56a9438354ad</processid>
  </stage>
  <stage stageid="4765a529-45f2-4cd1-a8c9-73317e3346f7" name="End1" type="End">
    <subsheetid>591a313e-ab53-49d4-8aa0-867fc82c9d18</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>165</displayx>
    <displayy>-30</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="b49c72a0-9e78-4f8c-94fb-75e3174cc0f8" name="Locked" type="Data">
    <subsheetid>591a313e-ab53-49d4-8aa0-867fc82c9d18</subsheetid>
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d0f1be0b-aa8b-409b-93ab-569b6d5867b0" name="Delay" type="Data">
    <subsheetid>16600e55-0e0d-48bb-af54-c9481546764d</subsheetid>
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>timespan</datatype>
    <initialvalue>0.00:00:00</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="3263716a-0ab1-4830-b951-c6b3675e24c7" name="Is Logged In" type="SubSheetInfo">
    <subsheetid>9be1bfb7-5b8e-4745-835d-94edb996a86d</subsheetid>
    <narrative>
    </narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="5b001eae-cc4a-453a-b193-0da5ab00915e" name="Start" type="Start">
    <subsheetid>9be1bfb7-5b8e-4745-835d-94edb996a86d</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <onsuccess>1ade2596-f773-4263-b2f8-9ac78dd13808</onsuccess>
  </stage>
  <stage stageid="320de7cd-31f9-44ac-8f91-6802faa49907" name="End" type="End">
    <subsheetid>9be1bfb7-5b8e-4745-835d-94edb996a86d</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="Logged In" stage="Logged In" />
    </outputs>
  </stage>
  <stage stageid="1ade2596-f773-4263-b2f8-9ac78dd13808" name="Logged In" type="Code">
    <subsheetid>9be1bfb7-5b8e-4745-835d-94edb996a86d</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="Logged In" stage="Logged In" />
    </outputs>
    <onsuccess>320de7cd-31f9-44ac-8f91-6802faa49907</onsuccess>
    <code><![CDATA[Logged_In = (GetLoggedInUsers().Count > 0)]]></code>
  </stage>
  <stage stageid="05e45da1-427b-4a7e-bf38-75b73c0015ec" name="Logged In" type="Data">
    <subsheetid>9be1bfb7-5b8e-4745-835d-94edb996a86d</subsheetid>
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="58cf41b0-bce5-48ec-9c82-3069394077fd" name="Logged In Users" type="SubSheetInfo">
    <subsheetid>58da59f5-3981-487b-bce1-4955720512fd</subsheetid>
    <narrative>
    </narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="38c585a6-1b8f-4104-83a0-2265075ae1e0" name="Start" type="Start">
    <subsheetid>58da59f5-3981-487b-bce1-4955720512fd</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <onsuccess>a460e229-02b0-46fc-a383-ca3ea186c1d1</onsuccess>
  </stage>
  <stage stageid="69b4c3ce-f00d-4d23-84d6-fd410c1f1a4a" name="End" type="End">
    <subsheetid>58da59f5-3981-487b-bce1-4955720512fd</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="collection" name="Users" stage="Users" />
    </outputs>
  </stage>
  <stage stageid="a460e229-02b0-46fc-a383-ca3ea186c1d1" name="Get Logged In Users" type="Code">
    <subsheetid>58da59f5-3981-487b-bce1-4955720512fd</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="collection" name="Users" stage="Users" />
    </outputs>
    <onsuccess>69b4c3ce-f00d-4d23-84d6-fd410c1f1a4a</onsuccess>
    <code><![CDATA[Users = New DataTable()
Const userNameCol As String = "Name"
Users.Columns.Add(userNameCol)
For Each username As String In GetLoggedInUsers()
	Dim row As DataRow = Users.NewRow()
	row(userNameCol) = username
	Users.Rows.Add(row)
Next]]></code>
  </stage>
  <stage stageid="b143f0e3-7091-43dc-8048-8f52afef6834" name="Users" type="Collection">
    <subsheetid>58da59f5-3981-487b-bce1-4955720512fd</subsheetid>
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>collection</datatype>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="748cda20-fa82-47bd-bab0-5745fc42796d" name="Local" type="Data">
    <subsheetid>fc7330a9-6031-4a16-9d1a-37eaad47dd3c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>210</displayx>
    <displayy>-180</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="4890907d-a0bf-4db7-ae32-ff9e1a78e198" name="Local" type="Data">
    <subsheetid>92b155c1-247d-473f-9f8b-f093f6dffbcf</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>210</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="24be8ab1-3a7a-4af6-b752-fb6afe58bf49" name="Get Credential Name" type="SubSheetInfo">
    <subsheetid>8844e841-e52e-4c9e-8e09-83f96fe6b114</subsheetid>
    <narrative>Gets the credential name for this machine, using the format defined in the 'Login Format String' environment variable</narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="f83cf421-5801-4b2d-9c8c-c35ff4229bcf" name="Start" type="Start">
    <subsheetid>8844e841-e52e-4c9e-8e09-83f96fe6b114</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-30</displayx>
    <displayy>-120</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <onsuccess>30d0a48e-145c-41cb-b8f3-d809b852d6a9</onsuccess>
  </stage>
  <stage stageid="6ce678f8-2b76-48cf-8bdb-f4f576c04049" name="End" type="End">
    <subsheetid>8844e841-e52e-4c9e-8e09-83f96fe6b114</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-30</displayx>
    <displayy>-30</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="text" name="Credential Name" narrative="The name of the credential for this machine" stage="Credential Name" />
    </outputs>
  </stage>
  <stage stageid="d5a611a7-bebe-4331-8234-77dd30061dc5" name="Login Format String" type="Data">
    <subsheetid>8844e841-e52e-4c9e-8e09-83f96fe6b114</subsheetid>
    <narrative>
    </narrative>
    <displayx>-195</displayx>
    <displayy>-30</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue xml:space="preserve">Windows Login: {0}</initialvalue>
    <exposure>Environment</exposure>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="4bf9d81c-3233-4f0e-8d6e-b25a24446184" name="Credential Name" type="Data">
    <subsheetid>8844e841-e52e-4c9e-8e09-83f96fe6b114</subsheetid>
    <narrative>
    </narrative>
    <displayx>-195</displayx>
    <displayy>0</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="30d0a48e-145c-41cb-b8f3-d809b852d6a9" name="Get Credential Name" type="Code">
    <subsheetid>8844e841-e52e-4c9e-8e09-83f96fe6b114</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-30</displayx>
    <displayy>-75</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="FormatString" expr="[Login Format String]" />
    </inputs>
    <outputs>
      <output type="text" name="Credential Name" stage="Credential Name" />
    </outputs>
    <onsuccess>6ce678f8-2b76-48cf-8bdb-f4f576c04049</onsuccess>
    <code><![CDATA[Credential_Name = String.Format( _
	FormatString, Environment.MachineName)]]></code>
  </stage>
  <stage stageid="b2970195-9328-4dee-b504-5cd2bc373ddd" name="Is Logged In" type="SubSheet">
    <subsheetid>fc7330a9-6031-4a16-9d1a-37eaad47dd3c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="Logged In" stage="Logged In" />
    </outputs>
    <onsuccess>b71ecff7-e01d-465a-8db3-73fc7038381e</onsuccess>
    <processid>9be1bfb7-5b8e-4745-835d-94edb996a86d</processid>
  </stage>
  <stage stageid="962450d9-400d-4f40-b741-dee229f336a4" name="Logged In" type="Data">
    <subsheetid>fc7330a9-6031-4a16-9d1a-37eaad47dd3c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="b71ecff7-e01d-465a-8db3-73fc7038381e" name="Logged In?" type="Decision">
    <subsheetid>fc7330a9-6031-4a16-9d1a-37eaad47dd3c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <decision expression="[Logged In]" />
    <ontrue>6bdfa233-6b5f-4b5f-9f3d-3934c4659362</ontrue>
    <onfalse>b72b5e50-4b85-446c-ad67-18738c8a411a</onfalse>
  </stage>
  <stage stageid="6bdfa233-6b5f-4b5f-9f3d-3934c4659362" name="End2" type="End">
    <subsheetid>fc7330a9-6031-4a16-9d1a-37eaad47dd3c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-75</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="5d01782b-bf4f-4014-876f-6f99f816979a" name="Authenticate To Windows" type="SubSheetInfo">
    <subsheetid>3b5b1d1e-cc3f-42d1-b366-db7b87ef1b31</subsheetid>
    <narrative>Authenticates to Windows using the given user name and password using either a local machine login or a domain login as specified.</narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="b105a242-c87d-4b20-bcea-2c4dc2a729ac" name="Start" type="Start">
    <subsheetid>3b5b1d1e-cc3f-42d1-b366-db7b87ef1b31</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Username" narrative="The username to use to authenticate to windows" stage="Username" />
      <input type="password" name="Password" narrative="The password to use to authenticate to Windows" stage="Password" />
      <input type="flag" name="Local" narrative="True to authenticate using local machine authentication; False to use domain authentication" stage="Local" />
      <input type="text" name="Domain" narrative="The name of the domain to authenticate with. Ignored if 'Local' is true; If blank will use the domain that the machine is a member of" stage="Domain" />
    </inputs>
    <onsuccess>d819e4e7-8492-4234-9578-c4d5c02ba865</onsuccess>
  </stage>
  <stage stageid="2f9731ab-8fd6-484d-ae58-915608eaf0cc" name="Username" type="Data">
    <subsheetid>3b5b1d1e-cc3f-42d1-b366-db7b87ef1b31</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>120</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d4f48493-05cf-411e-8ac1-0bc270d19967" name="Password" type="Data">
    <subsheetid>3b5b1d1e-cc3f-42d1-b366-db7b87ef1b31</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>180</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>password</datatype>
    <initialvalueenc>
    </initialvalueenc>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="1e9cc35c-6057-40b7-b081-c8e756a7fbbe" name="Local" type="Data">
    <subsheetid>3b5b1d1e-cc3f-42d1-b366-db7b87ef1b31</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>240</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>False</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="691183cf-3f78-4a1e-91f1-d32fea281c5c" name="End" type="End">
    <subsheetid>3b5b1d1e-cc3f-42d1-b366-db7b87ef1b31</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="d819e4e7-8492-4234-9578-c4d5c02ba865" name="Authenticate" type="Code">
    <subsheetid>3b5b1d1e-cc3f-42d1-b366-db7b87ef1b31</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-45</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Username" expr="[Username]" />
      <input type="password" name="Password" expr="[Password]" />
      <input type="flag" name="Local" expr="[Local]" />
      <input type="text" name="Domain" expr="[Domain]" />
    </inputs>
    <onsuccess>691183cf-3f78-4a1e-91f1-d32fea281c5c</onsuccess>
    <code><![CDATA[Using h As SafeFileHandle = CreateFile( _
 "\\.\pipe\" & PipeName, _
 GENERIC_READ Or GENERIC_WRITE, _
 0, _
 IntPtr.Zero, _
 OPEN_EXISTING, _
 0, _
 IntPtr.Zero)

	If h.IsInvalid Then Throw New Exception("Named pipe handle is invalid")

	Using fs As New FileStream(h, FileAccess.ReadWrite)
		Dim dom As String
		If Local Then
			dom = Environment.MachineName
		Else If Domain = "" Then
			dom = Environment.UserDomainName
		Else
			dom = Domain
		End If

		' We don't use a 'Using' here, since the
		' stream writer closes its stream when
		' disposed
		Dim sw As New StreamWriter(fs, New UTF8Encoding(False))
		sw.Write("{0}{3}{1}{3}{2}", dom, username, password, vbLf)
		sw.Flush()

		Try
			Dim sr As New StreamReader(fs, Encoding.ASCII)
			Dim resp As String = sr.ReadLine()
			If resp IsNot Nothing Then resp = resp.Trim()
			If resp <> "" AndAlso resp <> "OK" Then Throw New ApplicationException( _
			 "Unrecognised responsed from logon system: " & resp)
		Catch ' Ignore... it could just have closed the stream
		End Try

	End Using

End Using
]]></code>
  </stage>
  <stage stageid="8df61495-c294-4b91-a699-fb4341561c26" name="Last Error" type="Data">
    <subsheetid>3b5b1d1e-cc3f-42d1-b366-db7b87ef1b31</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>255</displayx>
    <displayy>15</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue>0</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="1a324870-a477-4491-ae2a-e791c1659a78" name="Block1" type="Block">
    <subsheetid>3b5b1d1e-cc3f-42d1-b366-db7b87ef1b31</subsheetid>
    <narrative>
    </narrative>
    <displayx>-75</displayx>
    <displayy>-75</displayy>
    <displaywidth>375</displaywidth>
    <displayheight>60</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="7FB2E5" />
  </stage>
  <stage stageid="6a3f76a4-e285-46a1-b562-a3e9a5025947" name="Recover" type="Recover">
    <subsheetid>3b5b1d1e-cc3f-42d1-b366-db7b87ef1b31</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <onsuccess>fbe5c089-a947-413d-b4fc-65bc2902fb07</onsuccess>
  </stage>
  <stage stageid="fbe5c089-a947-413d-b4fc-65bc2902fb07" name="GetLastError" type="Code">
    <subsheetid>3b5b1d1e-cc3f-42d1-b366-db7b87ef1b31</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>15</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="number" name="ErrNo" stage="Last Error" />
    </outputs>
    <onsuccess>18f685e1-5939-4381-ae5d-067ef0b6da8a</onsuccess>
    <code><![CDATA[ErrNo = Marshal.GetLastWin32Error()]]></code>
  </stage>
  <stage stageid="18f685e1-5939-4381-ae5d-067ef0b6da8a" name="REFAIL" type="Exception">
    <subsheetid>3b5b1d1e-cc3f-42d1-b366-db7b87ef1b31</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <exception type="" detail="" usecurrent="yes" />
  </stage>
  <stage stageid="b72b5e50-4b85-446c-ad67-18738c8a411a" name="Authenticate To Windows" type="SubSheet">
    <subsheetid>fc7330a9-6031-4a16-9d1a-37eaad47dd3c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-30</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Username" narrative="The username to use to authenticate to windows" expr="[Username]" />
      <input type="password" name="Password" narrative="The password to use to authenticate to Windows" expr="[Password]" />
      <input type="flag" name="Local" narrative="True to authenticate using local machine authentication; False to use domain authentication" expr="[Local]" />
      <input type="text" name="Domain" narrative="The name of the domain to authenticate with. Ignored if 'Local' is true; If blank will use the domain that the machine is a member of" expr="[Domain]" />
    </inputs>
    <onsuccess>ce3cef39-0134-470c-b59c-273616b66622</onsuccess>
    <processid>3b5b1d1e-cc3f-42d1-b366-db7b87ef1b31</processid>
  </stage>
  <stage stageid="9fe2dde9-48a0-40ad-89b5-046add650133" name="Is Logged In" type="SubSheet">
    <subsheetid>8b88ea92-5fc1-4135-8889-56a9438354ad</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-75</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="Logged In" stage="Logged In" />
    </outputs>
    <onsuccess>19ef5458-4e29-48e1-b1c1-8e3daf0f288c</onsuccess>
    <processid>9be1bfb7-5b8e-4745-835d-94edb996a86d</processid>
  </stage>
  <stage stageid="19ef5458-4e29-48e1-b1c1-8e3daf0f288c" name="Logged In?" type="Decision">
    <subsheetid>8b88ea92-5fc1-4135-8889-56a9438354ad</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <decision expression="[Logged In]" />
    <ontrue>f206c22a-d1c7-4c7f-9a17-3181943398bc</ontrue>
    <onfalse>066e6685-36e5-4c06-b927-cb4ba17ebad2</onfalse>
  </stage>
  <stage stageid="066e6685-36e5-4c06-b927-cb4ba17ebad2" name="End2" type="End">
    <subsheetid>8b88ea92-5fc1-4135-8889-56a9438354ad</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-75</displayx>
    <displayy>-15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="Locked" stage="Locked" />
    </outputs>
  </stage>
  <stage stageid="9fe49ac3-dc70-47bb-8828-0d08ba43b07a" name="Logged In" type="Data">
    <subsheetid>8b88ea92-5fc1-4135-8889-56a9438354ad</subsheetid>
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>-75</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d580bec5-8bc4-41f3-9826-f2092d81933b" name="Domain" type="Data">
    <subsheetid>3b5b1d1e-cc3f-42d1-b366-db7b87ef1b31</subsheetid>
    <narrative>
    </narrative>
    <displayx>300</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="dce64519-ae10-4069-82a8-31e5704b646a" name="Domain" type="Data">
    <subsheetid>92b155c1-247d-473f-9f8b-f093f6dffbcf</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>270</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="5a5aec3a-15b9-462c-bb92-d1a79b8cdfca" name="Domain" type="Data">
    <subsheetid>fc7330a9-6031-4a16-9d1a-37eaad47dd3c</subsheetid>
    <narrative>
    </narrative>
    <displayx>270</displayx>
    <displayy>-180</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="85c4aec5-25b7-4651-bd6e-c69eb13bd6dd" name="Start" type="Start">
    <subsheetid>fc7330a9-6031-4a16-9d1a-37eaad47dd3c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-180</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Tahoma" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Username" narrative="The username to use to authenticate to windows" stage="Username" />
      <input type="password" name="Password" narrative="The password to use to authenticate to Windows" stage="Password" />
      <input type="flag" name="Local" narrative="True to authenticate using local machine authentication; False to use domain authentication" stage="Local" />
      <input type="text" name="Domain" narrative="The name of the domain to authenticate with. Ignored if 'Local' is true; If blank will use the domain that the machine is a member of" stage="Domain" />
    </inputs>
    <onsuccess>b2970195-9328-4dee-b504-5cd2bc373ddd</onsuccess>
  </stage>
</process>